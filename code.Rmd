---
output:
  pdf_document:
    fig_caption: yes
    number_sections: no
   # toc: true
#bibliography: library.bib
---

```{r setup, include=FALSE}
library(dplyr)
library(plyr)
library(emibase)
library(plotrix)
source('functions.R')
```

\vskip 20pt
\centerline{\bf \large VILNIUS UNIVERSITY}
\bigskip
\centerline{\large \textbf{FACULTY OF MATHEMATICS AND INFORMATICS}}
\vskip 120pt
\centerline{\bf \Large \textbf{BACHELOR THESIS}}
\vskip 50pt
\begin{center}
{\bf \LARGE Global terrorism and the economy}

\vspace{4mm}

\end{center}
\vskip 120pt
\centerline{\Large Eligijus Bujokas}
\vskip 120pt
\centerline{\large \textbf{VILNIUS (2016.12.07)}}

\newpage




\tableofcontents

\newpage

```{r constants, include=FALSE}
years.to.survey <- 1970:2015
```

```{r data download and reading it, include=FALSE, echo=F}
# we will save this data to the 'data folder'
download.terror(years.to.survey, "data/") 
dt <- read.terror("data/")
dt <- arrange(dt, Date)
```

```{r descriptive statistics, include=FALSE, echo=F, warning=F}
# we will save this data to the 'data folder'
summary(dt$Fatalities) ## As we can see there is a huge incident involving 1382 deaths
summary(dt$Injured)    ## The mean of injured people is higher than those that were killed. The biggest incident is involving 4000 people
dt[which(dt$Fatalities==max(dt$Fatalities, na.rm=T)), ] # The deadliest attack was the infamous 9/11 attack
dt[which(dt$Injured==max(dt$Injured, na.rm=T)), ]       # The most injuries was caused by the attack in Kenya in 1998

sum(dt$Injured, na.rm=T) # The total people injured between 1970 and 2015 worldwide is 125718
sum(dt$Fatalities, na.rm=T) # The total people killed between 1970 and 2015 worldwide is 97233


## Creating a pie chart
createdir("plots")
pdf(file = "plots/Injuries and deaths pie chart.pdf", width = 15, height = 10)

pie.chart(dt$Fatalities, c(0, 1, 5, 100), cols=c("dodgerblue1", "orchid4", "gray48", "peru"), 
          title = "Fatalities")

pie.chart(dt$Injured, c(0, 1, 5, 100), cols=c("dodgerblue1", "orchid4", "gray48", "peru"), 
          title = "Injuries")
dev.off()

## Overall trend

pdf(file = "plots/daily monthly yearly casualties.pdf", width = 15, height = 10)

# excluding daily because of long calculation times

for(fr in c("monthly", "yearly")){
  data.to.plot <- aggregate.terror(dt, freq = fr)
  
  points <- cbind(data.to.plot$Injured, data.to.plot$Killed)
  
  time.span <- seq(years.to.survey[1],
                   years.to.survey[length(years.to.survey)],
                   length.out = dim(data.to.plot)[1])
  
  grid.frame(x = time.span, y = points, grid.lty = 2, grid.col = "royalblue")
  
  matplot(x= time.span, y=points, add=T, type = "o", pch=20, lwd = 2, lty = 1, cex=1, 
              col=c("firebrick3", "dodgerblue3"))
  legendary2(c("Injured", "Killed"), col=c("firebrick3", "dodgerblue3"))
  mtext(paste("Frequency is", fr), line=1, adj = 0, font = 2, cex = 1.25, col="darkslateblue")
}
dev.off()

```





